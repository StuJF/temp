function getCbars(varargin)
% initialize
Ctype = getCtype();
global colorBar
colorBar = [];
figh = [];
if ~isempty(varargin)
   figh = varargin{1}; 
   if ~isa(figh,'matlab.ui.Figure')
       figh = [];
   end
end

% no input, disp colorbar
h = figure('position',[314 327 1000 420],'keyPressFcn',{@makeBars,figh});
showAx = axes('Parent',h,'position',[0.04 0.2 0.07 0.7],'visible','off','Ylim',[0,1],'Tag','showAx');
for itype = 1:5
    subplot(1,5,itype);
    colnum = 10;
    colnumt = colnum;
    if itype==5
        colnumt=11;
    end
    for icol = 1:colnumt
        X = [0 0 1 1]./9;
        Y = 0.1*[1 0 0 1]+1/(colnum+1)*(2*icol-1);
        order = itype*colnum-colnum+icol;
        tcolor = Ctype{order}./255;
        if size(tcolor,1)<9
            tcolor = lineInterp(tcolor,9,1);
        end
        if size(tcolor,1)>9
            tlen = size(tcolor,1);
            tidx = round(linspace(1,tlen,9));
            tcolor = tcolor (tidx,:);
        end
        for ix = 1:size(tcolor,1)
            X2 = X+(ix-1)/9;
            fill(X2,Y,tcolor(ix,:),'linestyle','none','ButtonDownFcn',{@select_Fun,showAx,figh});
            xlim([-0.4 1]);
            hold all
        end
        axis off
        set(gcf,'color',[0.9 0.9 0.9])
    end
end
disp('Refer to cbrewer')



end





function select_Fun(obj,event,varargin)
color = obj.FaceColor;
global colorBar
switch event.Button
    case 1
        colorBar = color;
    case 2
        idx = sum(colorBar==color,2) ==3;
        colorBar(idx,:) = [];
    case 3
        colorBar = [colorBar;color];
end
ax2plot = varargin{1};
% figh = varargin{2};
inum = size(colorBar,1);
X = [0 0 1 1];
Y = [1 0 0 1]./inum;
tlen = 1/inum;
set(obj.Parent.Parent,'CurrentAxes',ax2plot);

for ti = 1:inum
    Yi = Y+(ti-1)*tlen;
    fill(X,Yi,colorBar(ti,:),'LineStyle','none','ButtonDownFcn',{@select_Fun,ax2plot});
    hold all
    %    set(ax2plot,'YLim',[0,1]);
end
title(num2str(roundn(color,-2)));
set(ax2plot,'xtick',[],'ytick',[]);
end

function makeBars(varargin)
hobj = varargin{1};
ax2plot = hobj.Children(end);
figh = varargin{3};
keytype = varargin{2};
if strcmp(keytype.Key,'return')
    global colorBar
    try
        Cbars = lineInterp(colorBar,256,8);
        inum = size(Cbars,1);
        X = [0 0 1 1];
        Y = [1 0 0 1]./inum;
        tlen = 1/inum;
        set(hobj,'CurrentAxes',ax2plot);
        
        for ti = 1:inum
            Yi = Y+(ti-1)*tlen;
            fill(X,Yi,Cbars(ti,:),'LineStyle','none');
            hold all
            %    set(ax2plot,'YLim',[0,1]);
        end
        title('colorbar');
        set(ax2plot,'xtick',[],'ytick',[]);
        assignin('base','MyColorbar',Cbars);
        if ~isempty(figh)
           set(figh,'Colormap',Cbars); 
        end
        
    catch
    end
end

end

function Cbar = lineInterp(cbar,cnum,pernum)
np = size(cbar,1);
nump = max(round(cnum/(np-1)),pernum);
for ic = 1:3
    tcolor = cbar(:,ic);
    ncolor = [];
    for itc = 1:np-1
        ncolor = [ncolor,linspace(tcolor(itc),tcolor(itc+1),nump)];
    end
    Cbar(:,ic) = ncolor';
end
if size(Cbar,1)>cnum
    Cbar(round(end/2),:)=[];
end
end

function Ctype = getCtype()
Ctype{1} = [247,252,253;229,245,249;204,236,230;153,216,201;102,194,164;
    65,174,118;35,139,69;0,109,44;0,68,27];
Ctype{2} = [247,252,253;224,236,244;191,211,230;158,188,218;140,150,198;
    140,107,177;136,65,157;129,15,124;77,0,75];
Ctype{3} = [247,252,240;224,243,219;204,235,197;168,221,181;123,204,196;
    78,179,211;43,140,190;8,104,172;8,64,129];
Ctype{4} = [255,247,236;254,232,200;253,212,158;253,187,132;252,141,89;
    239,101,72;215,48,31;179,0,0;127,0,0];
Ctype{5} = [255,247,251;236,231,242;208,209,230;166,189,219;116,169,207;
    54,144,192;5,112,176;4,90,141;2,56,88];
Ctype{6} = [255,247,251;236,226,240;208,209,230;166,189,219;103,169,207;
    54,144,192;2,129,138;1,108,89;1,70,54];
Ctype{7} = [247,244,249;231,225,239;212,185,218;201,148,199;223,101,176;
    231,41,138;206,18,86;152,0,67;103,0,31];
Ctype{8} = [255,247,243;253,224,221;252,197,192;250,159,181;247,104,161;
    221,52,151;174,1,126;122,1,119;73,0,106];
Ctype{9} = [255,255,229;247,252,185;217,240,163;173,221,142;120,198,121;
    65,171,93;35,132,67;0,104,55;0,69,41];
Ctype{10} = [255,255,217;237,248,177;199,233,180;127,205,187;65,182,196;
    29,145,192;34,94,168;37,52,148;8,29,88];
Ctype{11} = [255,255,229;255,247,188;254,227,145;254,196,79;254,153,41;
    236,112,20;204,76,2;153,52,4;102,37,6];
Ctype{12} = [255,255,204;255,237,160;254,217,118;254,178,76;253,141,60;
    252,78,42;227,26,28;189,0,38;128,0,38];
Ctype{13} = [247,251,255;222,235,247;198,219,239;158,202,225;107,174,214;
    66,146,198;33,113,181;8,81,156;8,48,107];
Ctype{14} = [247,252,245;229,245,224;199,233,192;161,217,155;116,196,118;
    65,171,93;35,139,69;0,109,44;0,68,27];
Ctype{15} = [255,255,255;240,240,240;217,217,217;189,189,189;150,150,150;
    115,115,115;82,82,82;37,37,37;0,0,0];
Ctype{16} = [255,245,235;254,230,206;253,208,162;253,174,107;253,141,60;
    241,105,19;217,72,1;166,54,3;127,39,4];
Ctype{17} = [252,251,253;239,237,245;218,218,235;188,189,220;158,154,200;
    128,125,186;106,81,163;84,39,143;63,0,125];
Ctype{18} = [255,245,240;254,224,210;252,187,161;252,146,114;251,106,74;
    239,59,44;203,24,29;165,15,21;103,0,13];
Ctype{19} = [140,81,10;191,129,45;223,194,125;246,232,195;245,245,245;
    199,234,229;128,205,193;53,151,143;1,102,94];
Ctype{20} = [197,27,125;222,119,174;241,182,218;253,224,239;247,247,247;
    230,245,208;184,225,134;127,188,65;77,146,33];
Ctype{21} = [118,42,131;153,112,171;194,165,207;231,212,232;247,247,247;
    217,240,211;166,219,160;90,174,97;27,120,55];
Ctype{22} = [179,88,6;224,130,20;253,184,99;254,224,182;247,247,247;
    216,218,235;178,171,210;128,115,172;84,39,136];
Ctype{23} = [178,24,43;214,96,77;244,165,130;253,219,199;247,247,247;
    209,229,240;146,197,222;67,147,195;33,102,172];
Ctype{24} = [178,24,43;214,96,77;244,165,130;253,219,199;255,255,255;
    224,224,224;186,186,186;135,135,135;77,77,77];
Ctype{25} = [215,48,39;244,109,67;253,174,97;254,224,144;255,255,191;
    224,243,248;171,217,233;116,173,209;69,117,180];
Ctype{26} = [215,48,39;244,109,67;253,174,97;254,224,139;255,255,191;
    217,239,139;166,217,106;102,189,99;26,152,80];
Ctype{27} = [213,62,79;244,109,67;253,174,97;254,224,139;255,255,191;
    230,245,152;171,221,164;102,194,165;50,136,189];
Ctype{28} = [166,206,227;31,120,180;178,223,138;51,160,44;251,154,153;
    227,26,28;253,191,111;255,127,0;202,178,214];
Ctype{29} = [251,180,174;179,205,227;204,235,197;222,203,228;254,217,166;
    255,255,204;229,216,189;253,218,236;242,242,242];
Ctype{30} = [228,26,28;55,126,184;77,175,74;152,78,163;255,127,0;
    255,255,51;166,86,40;247,129,191;153,153,153];
Ctype{31} = [141,211,199;255,255,179;190,186,218;251,128,114;128,177,211;
    253,180,98;179,222,105;252,205,229;217,217,217];
Ctype{32} = [255,0,255;255 255 0];
Ctype{33} = [255 0 255;0 255 255];
Ctype{34} = [255  223 0;200 17 63;140 0 255];
Ctype{35} = [100 0 0;255 255 0];
Ctype{36} = [230 0 18;255 255 255;40 68 154];
Ctype{37} = [120 79 255;255 255 255;255 107 50];
Ctype{38} = parula*255;
Ctype{39} = jet*255;
Ctype{40} = hsv*255;
Ctype{41} = hot*255;
Ctype{42} = summer*255;
Ctype{43} = autumn*255;
Ctype{44} = winter*255;
Ctype{45} = [65     0    20;
    78    37    72;
    86    65   126;
    72   100   169;
    68   136   164;
   123   159   154;
   171   182   143;
   230   204   101;
   253   244    25];
Ctype{46} = [0     0     0;
     0     0    85;
     0     0   255;
     0   170   170;
     0   255     0;
   255   255     0;
   255    85     0;
   241     0     0;
     0     0     0];
Ctype{47} = [0     0   255;
    22    89   255;
    44   181   255;
    84   218   241;
   124   254   226;
   255   223    63;
   255   190     0;
   255    95     0;
   255     0     0];
Ctype{48} = [ 0     0     0;
    39    24    15;
    79    49    31;
   119    74    47;
   159    99    63;
   199   124    79;
   239   149    95;
   255   174   111;
   255   199   127];
Ctype{49} = [  20     2    72;
    20    62   146;
    44   122   163;
   142   168   182;
   224   220   221;
   204   144   180;
   190    49   126;
   129     1    23;
    42     4     1];
Ctype{50} = [ 0     0   255;
    62    62   255;
   126   126   255;
   191   191   255;
   255   255   255;
   255   193   193;
   255   129   129;
   255    64    64;
   255     0     0];
Ctype{51} = [ 0     0     4;
    28    16    68;
    79    18   123;
   129    37   129;
   181    54   122;
   229    80   100;
   251   135    97;
   254   194   135;
   252   253   191];
end
